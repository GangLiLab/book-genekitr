# (PART\*) Part II: ID Conversion {-}

```{r include=FALSE}
library(knitr)
opts_chunk$set(message=FALSE, warning=FALSE, eval=TRUE, echo=TRUE, cache=TRUE)
library(genekitr)
library(clusterProfiler)
library(dplyr)
```

# Gene ID conversion {#gene-id-conversion}

The popular gene ID types include Symbol, NCBI Entrez and Ensembl. ID conversion among different types is very common. 


## Current tools {#convertion-current-tools}

Now there are many tools could handle id conversion including `r Biocpkg("biomaRt")`, `r Biocpkg("clusterProfiler.")` .

biomaRt is frequently used to access Ensembl database while clusterProfiler depends on NCBI database via Bioconductor annotation packages.

Genekitr combines both Ensembl and NCBI database to provide more comprehensive gene id mapping. Also id conversion supports many species (see also [session 1.2](#geninfo-supported-species))

## Basic usage {#transid-basic-usage}

`transId` is a sub function of `genInfo`, which has five arguments:

- `id`: gene id (symbol, Entrez or Ensembl) or protein id

- `transTo`: the conversion target type. User could select **one or more** from "symbol", "entrez", "ensembl" or "uniprot"

- `org`: organism name, default is human

- `unique`: `TRUE` or `FALSE`. If `TRUE`, only returns one matched id. Default is `FALSE`.

- `keepNA`: `TRUE` or `FALSE`. Some id has none matched id, save it or not. Default is `FALSE`.

The argument below "ens" represents "ensembl", if you do not want to type too many characters like me, just spell first characters.
```{r transid_basic_usage, warning=FALSE}
id <- c('AKT3','SSX6P','FAKE_ID','BCC7')
transId(id,transTo = 'ens')
```

Due to NA was removed, the result order is slightly different from input id. If you want to get the same order, you can save NA:
```{r}
transId(id,transTo = 'ens',keepNA = TRUE)
```

If you want to get one-to-one mapping and keep input id order:
```{r}
transId(id,transTo = 'ens',keepNA = TRUE,unique = TRUE)
```


## Features {#transid-features}

### Feature1: convert to several types {#transid-feature-1}

Just pass the wanted types to `transTo` parameter:

```{r}
transId(id, transTo = c('ens','ent'))
```

### Feature2: distinguish from symbol and alias {#transid-feature-2}

Gene alias is an alternative name for official gene symbol, like "BCC7" is actually alias for "TP53". Sometimes gene alias is much famous than official symbol, for example, "PDL1" is the alias for "CD274" in fact.

Here, `transId` could utilize both NCBI and Ensembl alias metadata to easily recognize them, user just need to set `transTo = 'symbol'`
```{r}
transId(c("BCC7","TP53","PD1","PDL1","TET2"),'sym')
```

### Feature3: no worry for Ensembl version {#transid-feature-3}

An Ensembl stable ID consists of five parts: ENS(species)(object type)(identifier). (version)
For example, `ENSG00000141510.11` is TP53 while the version `.11` may confuse many tools.
However using `transId`, user will not worry this issue any more.

```{r}
transId('ENSG00000141510.11','symbol')
```


## Real Example {#transid-real-exp}

### Example data {#transid-real-exp-data}
We got a differential expression analysis result from [GSE42872](https://www.ncbi.nlm.nih.gov//geo/query/acc.cgi?acc=GSE42872).
```{r}
data(deg,package = 'genekitr')
id = deg$ENTREZID
length(id)
```

Here we will take gene symbols in the result to compare id conversion efficiency of various tools.

### bitr from clusterProfiler {#transid-real-exp-bitr}

```{r}
### Using bitr
suppressWarnings(library(org.Hs.eg.db))
suppressMessages(library(clusterProfiler))
bitr_res = bitr(id,fromType = 'ENTREZID',toType = 'SYMBOL',OrgDb = 'org.Hs.eg.db')
bitr_sym = unique(bitr_res$SYMBOL)
length(bitr_sym)
```

### transId from genekitr {#transid-real-exp-transid}
```{r}
transid_res = transId(id,transTo = 'sym')
transid_sym = unique(transid_res$symbol)
length(transid_sym)
```

### compare results {#transid-real-exp-compare}
```{r}
plotVenn(list(bitr_sym=bitr_sym,transid_sym=transid_sym))
```

There are 114 genes only in `bitr` result:
```{r}
bitr_sym[!bitr_sym%in%transid_sym] %>% head()

# let's take a look for the first one FAM122C, which is converted from gene 159091
bitr_res %>% filter(SYMBOL%in%'FAM122C') %>% pull(ENTREZID)
```

When we search NCBI `r Entrez(159091)` and we could see the official symbol is "PABIR3" now while "FAM122C" is an alias. When we look back into `transId` result, it keeps update with NCBI web.

```{r}
transid_res %>% filter(input_id%in%'159091') %>% pull(symbol)
```

Besides, there are 140 unique symbols in `transId` result:
```{r}
transid_sym[!transid_sym%in%bitr_sym] %>% head()
# take a look at the second one: LIPT2-AS1
transid_res %>% filter(symbol == "LIPT2-AS1") %>% pull(input_id)
```

NCBI web also showed the same result with `transId`: `r Entrez(100287896)`, while `bitr` gets `LOC100287896` symbol for it.

We have total 18591 entrez id as input, while we get 18578 ids in `transId` result, why?
```{r}
transid_id <- unique(transid_res$input_id)
length(transid_id)

id[!id%in%transid_id]
```

When we search on NCBI web, we found the reason, they are replaced with new one. For example, the first one `r Entrez(23285)` is discontinued on 9-Nov-2019 and replaced with `r Entrez(284697)`.

```{r}
# As we get the latest id, we could convert it immediately!
transId('284697',transTo = 'sym')
```


